# دليل حل مشكلة خطأ 404 ومشاكل التطبيق

## نظرة عامة

هذا الدليل يساعدك في حل المشاكل الشائعة التي قد تواجهها عند استخدام تطبيق سامكو، بما في ذلك:
- خطأ 404 (الصفحة غير موجودة)
- انتهاء صلاحية المعاينة (Preview Expired)
- مشاكل التوجيه (Routing Issues)
- التطبيق لا يعمل

---

## المشكلة الظاهرة في الصورة المرفقة

### الرسالة المعروضة:
```
Refresh the page to continue
No operation for a long time, preview has expired. Please refresh to continue.
```

### التشخيص:
هذه **ليست مشكلة 404**، بل هي **انتهاء صلاحية المعاينة** من منصة Medo.dev.

### السبب:
- المعاينة (Preview) تنتهي صلاحيتها بعد فترة من عدم النشاط
- هذا سلوك طبيعي من منصة التطوير
- لا يؤثر على التطبيق المنشور (Production)

### الحل الفوري:
1. **اضغط على زر "Refresh the page"** الموجود في الرسالة
2. أو **أعد تحميل الصفحة** (F5 أو Cmd+R)
3. أو **اضغط على زر "Preview"** مرة أخرى من لوحة التحكم

---

## الحلول المطبقة في التطبيق

### 1. صفحة 404 مخصصة

تم إضافة صفحة خطأ 404 احترافية تظهر عندما يحاول المستخدم الوصول إلى صفحة غير موجودة.

**الملف**: `src/pages/NotFoundPage.tsx`

**المميزات**:
- ✅ تصميم جميل ومريح للعين
- ✅ رسالة واضحة بالعربية
- ✅ زر للعودة للصفحة الرئيسية
- ✅ زر للعودة للصفحة السابقة
- ✅ نصائح مساعدة

**كيف تعمل**:
```typescript
// في App.tsx
<Routes>
  {/* جميع المسارات المعرفة */}
  {routes.map((route) => (
    <Route path={route.path} element={<route.component />} />
  ))}
  
  {/* صفحة 404 لأي مسار غير معرف */}
  <Route path="*" element={<NotFoundPage />} />
</Routes>
```

---

### 2. إعادة توجيه SPA (Single Page Application)

تم إضافة ملف `public/_redirects` لضمان عمل التوجيه بشكل صحيح في الإنتاج.

**الملف**: `public/_redirects`

**المحتوى**:
```
# Redirect all routes to index.html for SPA routing
/*    /index.html   200
```

**الفائدة**:
- ✅ يضمن أن جميع المسارات تعمل بشكل صحيح
- ✅ يمنع أخطاء 404 عند تحديث الصفحة
- ✅ يدعم التوجيه من جانب العميل (Client-side Routing)

---

### 3. آلية Keep-Alive

تم إضافة آلية Keep-Alive لمنع التطبيق من الدخول في وضع السكون.

**الملف**: `src/utils/keepAlive.ts`

**كيف تعمل**:
- ✅ ترسل طلب بسيط كل 5 دقائق
- ✅ تحافظ على التطبيق نشطًا
- ✅ تمنع انتهاء الجلسة

**الفائدة**:
- التطبيق يبقى نشطًا دائمًا
- لا حاجة لإعادة التنشيط من لوحة التحكم
- تجربة مستخدم أفضل

---

## المشاكل الشائعة والحلول

### المشكلة 1: خطأ 404 عند تحديث الصفحة

**الأعراض**:
- التطبيق يعمل عند التنقل داخله
- عند تحديث الصفحة (F5) يظهر خطأ 404

**السبب**:
- الخادم لا يعرف كيف يتعامل مع مسارات SPA

**الحل**:
✅ **تم الحل**: ملف `public/_redirects` يحل هذه المشكلة تلقائيًا

**للتحقق**:
1. افتح أي صفحة في التطبيق (مثل `/create-video`)
2. اضغط F5 لتحديث الصفحة
3. يجب أن تعمل الصفحة بدون أخطاء

---

### المشكلة 2: انتهاء صلاحية المعاينة (Preview Expired)

**الأعراض**:
- رسالة "Refresh the page to continue"
- رسالة "No operation for a long time, preview has expired"

**السبب**:
- منصة Medo.dev تنهي المعاينة بعد فترة من عدم النشاط
- هذا سلوك طبيعي لتوفير الموارد

**الحل**:
1. **الحل الفوري**: اضغط "Refresh the page" أو أعد تحميل الصفحة
2. **الحل الدائم**: انشر التطبيق (Deploy) للحصول على رابط دائم

**ملاحظة**:
- ✅ آلية Keep-Alive تقلل من حدوث هذه المشكلة
- ✅ لكن المعاينة قد تنتهي بعد فترة طويلة جدًا من عدم النشاط

---

### المشكلة 3: التطبيق لا يعمل بعد النشر

**الأعراض**:
- التطبيق يعمل في المعاينة
- لا يعمل بعد النشر (Deploy)

**الأسباب المحتملة**:
1. متغيرات البيئة (Environment Variables) غير مضبوطة
2. مشكلة في إعدادات الخادم
3. ملفات مفقودة

**الحلول**:

#### أ. التحقق من متغيرات البيئة
تأكد من وجود جميع المتغيرات المطلوبة:
```env
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_ANON_KEY=your_supabase_key
VITE_APP_ID=your_app_id
```

#### ب. التحقق من ملف _redirects
تأكد من وجود ملف `public/_redirects` مع المحتوى الصحيح:
```
/*    /index.html   200
```

#### ج. إعادة البناء والنشر
```bash
npm run build
# ثم انشر مجلد dist
```

---

### المشكلة 4: صفحة بيضاء فارغة

**الأعراض**:
- الصفحة تحمل لكن لا يظهر شيء
- صفحة بيضاء فارغة

**الأسباب المحتملة**:
1. خطأ في JavaScript
2. مشكلة في التوجيه
3. مكونات مفقودة

**الحلول**:

#### أ. افتح Console للمطورين
1. اضغط F12 (أو Cmd+Option+I على Mac)
2. اذهب إلى تبويب "Console"
3. ابحث عن رسائل الخطأ باللون الأحمر

#### ب. تحقق من الشبكة
1. في أدوات المطورين، اذهب إلى تبويب "Network"
2. أعد تحميل الصفحة
3. تحقق من أن جميع الملفات تحمل بنجاح (200 OK)

#### ج. امسح الذاكرة المؤقتة
1. اضغط Ctrl+Shift+Delete (أو Cmd+Shift+Delete على Mac)
2. اختر "Cached images and files"
3. اضغط "Clear data"
4. أعد تحميل الصفحة

---

### المشكلة 5: التطبيق بطيء جدًا

**الأعراض**:
- التطبيق يستغرق وقتًا طويلاً للتحميل
- الانتقال بين الصفحات بطيء

**الأسباب المحتملة**:
1. اتصال إنترنت ضعيف
2. الخادم بعيد جغرافيًا
3. ملفات كبيرة الحجم

**الحلول**:

#### أ. تحقق من سرعة الإنترنت
- استخدم موقع speedtest.net للتحقق من سرعة الاتصال
- تأكد من أن السرعة أكثر من 5 Mbps

#### ب. امسح الذاكرة المؤقتة
- كما هو موضح في المشكلة 4

#### ج. استخدم متصفح حديث
- Chrome 92+
- Firefox 89+
- Safari 15.2+
- Edge 92+

---

## خطوات استكشاف الأخطاء العامة

### الخطوة 1: أعد تحميل الصفحة
- اضغط F5 (أو Cmd+R على Mac)
- أو اضغط Ctrl+F5 لإعادة التحميل الكاملة

### الخطوة 2: امسح الذاكرة المؤقتة
- Ctrl+Shift+Delete (أو Cmd+Shift+Delete على Mac)
- اختر "Cached images and files"
- اضغط "Clear data"

### الخطوة 3: افتح Console للمطورين
- اضغط F12
- اذهب إلى تبويب "Console"
- ابحث عن رسائل الخطأ

### الخطوة 4: تحقق من الشبكة
- في أدوات المطورين، تبويب "Network"
- أعد تحميل الصفحة
- تحقق من حالة الطلبات (200 = نجاح، 404 = غير موجود، 500 = خطأ خادم)

### الخطوة 5: جرب متصفح آخر
- إذا كانت المشكلة في متصفح واحد فقط، فالمشكلة من المتصفح
- جرب Chrome, Firefox, Safari, أو Edge

### الخطوة 6: تحقق من متغيرات البيئة
- تأكد من أن جميع المتغيرات المطلوبة موجودة
- تحقق من صحة القيم

---

## رسائل الخطأ الشائعة ومعانيها

### 404 Not Found
**المعنى**: الصفحة أو الملف غير موجود

**الحلول**:
- تحقق من صحة الرابط
- تأكد من أن الملف موجود
- تحقق من ملف `_redirects`

### 500 Internal Server Error
**المعنى**: خطأ في الخادم

**الحلول**:
- تحقق من سجلات الخادم (Server Logs)
- تأكد من صحة متغيرات البيئة
- أعد تشغيل الخادم

### Network Error
**المعنى**: مشكلة في الاتصال بالإنترنت

**الحلول**:
- تحقق من اتصال الإنترنت
- تحقق من إعدادات الجدار الناري (Firewall)
- جرب شبكة أخرى

### CORS Error
**المعنى**: مشكلة في سياسة المشاركة عبر المصادر (Cross-Origin Resource Sharing)

**الحلول**:
- تحقق من إعدادات CORS في الخادم
- تأكد من أن النطاق (Domain) مسموح به
- استخدم Proxy إذا لزم الأمر

---

## نصائح للحصول على أفضل أداء

### 1. استخدم متصفح حديث
- Chrome 92+
- Firefox 89+
- Safari 15.2+
- Edge 92+

### 2. اتصال إنترنت جيد
- سرعة أكثر من 5 Mbps
- اتصال مستقر (لا انقطاعات)

### 3. امسح الذاكرة المؤقتة بانتظام
- مرة كل أسبوع على الأقل
- بعد كل تحديث للتطبيق

### 4. أغلق التطبيقات الأخرى
- لتحرير الذاكرة
- لتحسين الأداء

### 5. استخدم وضع التصفح الخاص (Incognito)
- للتحقق من المشاكل
- لتجنب تأثير الإضافات (Extensions)

---

## الحصول على المساعدة

### إذا استمرت المشكلة:

#### 1. اجمع المعلومات التالية:
- نوع المتصفح والإصدار
- نظام التشغيل
- رسالة الخطأ الكاملة
- لقطة شاشة للمشكلة
- خطوات إعادة إنتاج المشكلة

#### 2. تحقق من Console:
- افتح أدوات المطورين (F12)
- انسخ جميع رسائل الخطأ
- انسخ رسائل التحذير (Warnings)

#### 3. تحقق من Network:
- افتح تبويب Network
- أعد تحميل الصفحة
- انسخ الطلبات الفاشلة (Failed Requests)

#### 4. اتصل بالدعم:
- أرسل جميع المعلومات المجمعة
- اشرح المشكلة بالتفصيل
- اذكر ما جربته من حلول

---

## الملفات المهمة للمراجعة

### 1. src/App.tsx
- التوجيه الرئيسي
- صفحة 404

### 2. src/routes.tsx
- تعريف جميع المسارات
- مكونات الصفحات

### 3. public/_redirects
- إعادة توجيه SPA
- منع أخطاء 404

### 4. src/utils/keepAlive.ts
- آلية Keep-Alive
- منع السكون

### 5. src/pages/NotFoundPage.tsx
- صفحة 404 المخصصة
- رسائل الخطأ

---

## الخلاصة

### ما تم إصلاحه:
- ✅ **صفحة 404 مخصصة**: تظهر عند الوصول لصفحة غير موجودة
- ✅ **إعادة توجيه SPA**: يمنع أخطاء 404 عند تحديث الصفحة
- ✅ **آلية Keep-Alive**: تحافظ على التطبيق نشطًا
- ✅ **معالجة أخطاء محسّنة**: رسائل واضحة بالعربية

### المشكلة في الصورة المرفقة:
- ❌ **ليست مشكلة 404**: بل انتهاء صلاحية المعاينة
- ✅ **الحل**: اضغط "Refresh the page" أو أعد تحميل الصفحة
- ✅ **الوقاية**: آلية Keep-Alive تقلل من حدوث هذه المشكلة

### التطبيق الآن:
- ✅ يتعامل مع جميع أخطاء التوجيه بشكل صحيح
- ✅ يعرض صفحة 404 جميلة عند الحاجة
- ✅ يبقى نشطًا لفترات أطول
- ✅ يعمل بشكل صحيح في الإنتاج

**الإصدار**: 3.1.0  
**التاريخ**: 2025-12-21  
**الحالة**: ✅ مكتمل ومختبر

---

## ملاحظات إضافية

### للمطورين:
- راجع ملف `AUDIO_MERGE_AND_KEEPALIVE.md` لمعلومات عن الميزات الأخرى
- راجع ملف `README.md` للتوثيق الكامل
- استخدم `npm run lint` للتحقق من الأخطاء

### للمستخدمين:
- التطبيق يعمل بشكل طبيعي
- انتهاء صلاحية المعاينة أمر طبيعي
- فقط أعد تحميل الصفحة عند الحاجة
- التطبيق المنشور لا يواجه هذه المشكلة

---

## الدعم

للأسئلة أو المشاكل:
- ملف المشروع: README.md
- دليل استكشاف الأخطاء: هذا الملف (TROUBLESHOOTING_404.md)
- دليل الميزات: AUDIO_MERGE_AND_KEEPALIVE.md
- التوجيه: src/App.tsx
- صفحة 404: src/pages/NotFoundPage.tsx
